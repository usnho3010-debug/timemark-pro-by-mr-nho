<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Timemark Web App Pro</title>

<style>
/* ===== THEME ===== */
:root{
  --bg1:#0f2027;
  --bg2:#203a43;
  --bg3:#2c5364;
  --card:rgba(255,255,255,.12);
  --text:#fff;
}
body.light{
  --bg1:#fdfbfb;
  --bg2:#ebedee;
  --bg3:#dfe9f3;
  --card:#fff;
  --text:#000;
}

/* ===== BASE ===== */
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,Arial}
body{
  margin:0;
  min-height:100vh;
  background:linear-gradient(135deg,var(--bg1),var(--bg2),var(--bg3));
  color:var(--text);
  display:flex;
  justify-content:center;
  padding:20px;
}
h3{margin:0 0 10px}

/* ===== CARD ===== */
.card{
  width:100%;
  max-width:480px;
  background:var(--card);
  border-radius:20px;
  padding:18px;
  backdrop-filter:blur(14px);
  box-shadow:0 20px 50px rgba(0,0,0,.35);
  position:relative;
  z-index:5;
}

/* ===== CONTROLS ===== */
.controls label{font-size:13px;opacity:.9}
.controls input,.controls button{
  width:100%;
  padding:10px;
  margin:6px 0;
  border-radius:10px;
  border:none;
  font-size:14px;
}
.controls button{
  background:#f6b800;
  font-weight:bold;
  cursor:pointer;
}
canvas{
  max-width:100%;
  margin-top:12px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,.3);
}

/* ===== FLOAT TOOLS ===== */
.tools{
  position:fixed;
  top:12px;
  right:12px;
  display:flex;
  gap:6px;
  z-index:10;
}
.tools button{
  padding:8px 10px;
  border:none;
  border-radius:8px;
  font-size:13px;
  cursor:pointer;
}

/* ===== TOAST ===== */
.toast{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  background:#000;
  color:#fff;
  padding:10px 16px;
  border-radius:20px;
  font-size:14px;
  opacity:0;
  transition:.4s;
  z-index:20;
}
.toast.show{opacity:1}

/* ===== HOA RÆ I ===== */
.petals{position:fixed;inset:0;pointer-events:none;z-index:1}
.petal{
  position:absolute;top:-10%;
  animation:fall linear infinite,sway ease-in-out infinite;
  opacity:.8;
}
@keyframes fall{to{transform:translateY(120vh)}}
@keyframes sway{0%{margin-left:0}50%{margin-left:30px}100%{margin-left:0}}
</style>
</head>

<body>

<!-- HOA -->
<div class="petals" id="petals"></div>

<!-- TOOLS -->
<div class="tools">
  <button onclick="toggleTheme()">ğŸŒ—</button>
  <button onclick="togglePetal()">ğŸŒ¸</button>
</div>

<!-- APP -->
<div class="card">

<h3>ğŸ“ Timemark Style Pro</h3>
<p>ğŸŒ¸ ChÃºc má»«ng nÄƒm má»›i â€“ An khang Â· Thá»‹nh vÆ°á»£ng ğŸŒ¸</p>

<div class="controls">
<input type="file" id="imageInput" accept="image/*">

<label>TiÃªu Ä‘á»</label>
<input id="title" value="Äiá»ƒm danh">

<label>Giá»</label>
<input id="time">

<label>NgÃ y</label>
<input id="date">

<label>Äá»‹a Ä‘iá»ƒm â€“ áº¤p / XÃ£ / Huyá»‡n</label>
<input id="address1">

<label>Äá»‹a Ä‘iá»ƒm â€“ Tá»‰nh / ThÃ nh phá»‘</label>
<input id="address2">

<button onclick="setNow()">â± Láº¥y giá»</button>
<button onclick="getGPS()">ğŸ“¡ GPS</button>
<button onclick="draw()">ğŸ–Š Táº¡o watermark</button>
<button onclick="download()">â¬‡ï¸ Táº£i áº£nh</button>
</div>

<canvas id="c"></canvas>

</div>

<div class="toast" id="toast">ğŸ‘‹ ChÃ o má»«ng báº¡n Ä‘áº¿n Timemark Pro</div>

<!-- ================= LOGIC WATERMARK (GIá»® NGUYÃŠN 100%) ================= -->
<script>
/* ğŸ”´ TOÃ€N Bá»˜ LOGIC CANVAS GIá»® NGUYÃŠN â€“ KHÃ”NG Äá»˜NG ğŸ”´ */
const DAMP = 0.85;
const c = document.getElementById("c");
const ctx = c.getContext("2d");
const imageInput = document.getElementById("imageInput");
let img = new Image();

function fs(p){
  const b=Math.min(c.width,c.height);
  return Math.max(12,Math.round(b*p*DAMP));
}

function roundRect(ctx,x,y,w,h,r){
 ctx.beginPath();
 ctx.moveTo(x+r,y);
 ctx.lineTo(x+w-r,y);
 ctx.quadraticCurveTo(x+w,y,x+w,y+r);
 ctx.lineTo(x+w,y+h-r);
 ctx.quadraticCurveTo(x+w,y+h,x+w-r,y+h);
 ctx.lineTo(x+r,y+h);
 ctx.quadraticCurveTo(x,y+h,x,y+h-r);
 ctx.lineTo(x,y+r);
 ctx.quadraticCurveTo(x,y,x+r,y);
 ctx.closePath();
 ctx.fill();
}

function generateCode(len=12){
 const s="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
 return Array.from({length:len},()=>s[Math.random()*s.length|0]).join("");
}

imageInput.addEventListener("change",e=>{
 const f=e.target.files[0]; if(!f) return;
 const r=new FileReader();
 r.onload=()=>img.src=r.result;
 r.readAsDataURL(f);
});

img.onload=()=>{
 c.width=img.width;
 c.height=img.height;
 ctx.drawImage(img,0,0);
};

function setNow(){
 const n=new Date();
 time.value=n.toLocaleTimeString("vi-VN",{hour:'2-digit',minute:'2-digit'});
 date.value=n.toLocaleDateString("vi-VN",{weekday:'long',day:'numeric',month:'long',year:'numeric'});
}

/* ===== GPS GIá»NG GOOGLE MAPS (KHÃ”NG API KEY) ===== */
function getGPS(){
 if(!navigator.geolocation){
   alert("Thiáº¿t bá»‹ khÃ´ng há»— trá»£ GPS");
   return;
 }

 navigator.geolocation.getCurrentPosition(async pos=>{
   const lat = pos.coords.latitude;
   const lon = pos.coords.longitude;

   try{
     const res = await fetch(
       `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`
     );
     const data = await res.json();
     const a = data.address || {};

     // áº¤p / xÃ£ / huyá»‡n
     address1.value = [
       a.hamlet,
       a.village,
       a.suburb,
       a.town,
       a.city_district,
       a.county
     ].filter(Boolean).join(", ");

     // Tá»‰nh / thÃ nh phá»‘
     address2.value = a.state || a.city || "";

   }catch(e){
     alert("KhÃ´ng láº¥y Ä‘Æ°á»£c Ä‘á»‹a chá»‰ tá»« báº£n Ä‘á»“");
   }
 }, ()=>{
   alert("KhÃ´ng thá»ƒ láº¥y vá»‹ trÃ­. Vui lÃ²ng báº­t GPS.");
 },{
   enableHighAccuracy:true,
   timeout:10000
 });
}

function draw(){
 if(!img.src) return alert("ChÆ°a chá»n áº£nh");
 ctx.drawImage(img,0,0);

 const pad=fs(0.03);

 const hBox=fs(0.062);
 const hDate=fs(0.036);
 const hAddr=fs(0.030);
 const hCommit=fs(0.034);
 const gap=fs(0.03);

 const totalH=hBox+gap+hDate+hAddr*2+gap+hCommit;
 let y=c.height-totalH-fs(0.04);
 if(y<pad) y=pad;

 /* ===== ÄIá»‚M DANH â€“ GIá»œ ===== */
 ctx.font=`bold ${fs(0.026)}px Arial`;
 const titleW=ctx.measureText(title.value).width+pad*1.6;
 ctx.font=`bold ${fs(0.036)}px Arial`;
 const timeW=ctx.measureText(time.value).width+pad*1.6;

 const r=fs(0.008);
 const totalW=titleW+timeW;

 ctx.fillStyle="#FFFFFF";
 roundRect(ctx,pad,y,totalW,hBox,r);

 ctx.fillStyle="#F6B800";
 ctx.beginPath();
 ctx.moveTo(pad+r,y);
 ctx.lineTo(pad+titleW,y);
 ctx.lineTo(pad+titleW,y+hBox);
 ctx.lineTo(pad+r,y+hBox);
 ctx.quadraticCurveTo(pad,y+hBox,pad,y+hBox-r);
 ctx.lineTo(pad,y+r);
 ctx.quadraticCurveTo(pad,y,pad+r,y);
 ctx.closePath();
 ctx.fill();

 ctx.textAlign="center";
 ctx.fillStyle="#000";
 ctx.font=`bold ${fs(0.026)}px Arial`;
 ctx.fillText(title.value,pad+titleW/2,y+hBox*0.64);

 ctx.fillStyle="#1F4FD8";
 ctx.font=`bold ${fs(0.036)}px Arial`;
 ctx.fillText(time.value,pad+titleW+timeW/2,y+hBox*0.64);
 ctx.textAlign="left";

 y+=hBox+gap;

 /* ===== NGÃ€Y + Äá»ŠA CHá»ˆ ===== */
 const textX=pad+fs(0.03);
 const startY=y;

 ctx.fillStyle="#FFFFFF";
 ctx.font=`bold ${fs(0.032)}px Arial`;
 ctx.fillText(date.value,textX,y);
 y+=hDate;

 ctx.font=`${fs(0.025)}px Arial`;
 if(address1.value){ ctx.fillText(address1.value,textX,y); y+=hAddr; }
 if(address2.value){ ctx.fillText(address2.value,textX,y); y+=hAddr; }

 ctx.fillStyle="#F6B800";
 ctx.fillRect(pad,startY-fs(0.024),fs(0.008),y-startY);

 y+=gap;

 /* ===== CAM Káº¾T ===== */
 ctx.fillStyle="rgba(255,255,255,0.45)";
 ctx.font=`${fs(0.023)}px Arial`;
 ctx.fillText("Cam káº¿t ngÃ y giá» chÃ¢n thá»±c",textX,y);

 /* ===== BRAND ===== */
 ctx.textAlign="right";
 ctx.font=`bold ${fs(0.035)}px Arial`;
 const markW=ctx.measureText("mark").width;
 ctx.fillStyle="#F6B800";
 ctx.fillText("Time",c.width-pad-markW,c.height-pad-fs(0.03));
 ctx.fillStyle="rgba(255,255,255,0.9)";
 ctx.fillText("mark",c.width-pad,c.height-pad-fs(0.03));
 ctx.fillStyle="rgba(255,255,255,0.45)";
 ctx.font=`${fs(0.024)}px Arial`;
 ctx.fillText("100% ChÃ¢n thá»±c",c.width-pad,c.height-pad);
 ctx.textAlign="left";

 /* ===== WATERMARK Dá»ŒC ===== */
 ctx.save();
 ctx.translate(c.width-fs(0.004),c.height/2);
 ctx.rotate(-Math.PI/2);
 ctx.fillStyle="rgba(255,255,255,0.70)";
 ctx.font=`${fs(0.016)}px Arial`;
 ctx.textAlign="center";
 ctx.fillText("â“’ "+generateCode()+" Â· Timemark Verified",0,0);
 ctx.restore();
}

function isIOS(){
 return /iPhone|iPad|iPod/i.test(navigator.userAgent);
}

function download(){
 if(!img.src) return;
 const d=c.toDataURL("image/png");
 if(isIOS()){
  const w=window.open();
  w.document.write(`<img src="${d}" style="max-width:100%">`);
 }else{
  const a=document.createElement("a");
  a.href=d;a.download="timemark-style.png";a.click();
 }
}

setNow();
</script>

<script>
/* ===== UI SCRIPT ===== */
const toast=document.getElementById("toast");
setTimeout(()=>toast.classList.add("show"),600);
setTimeout(()=>toast.classList.remove("show"),3500);

function toggleTheme(){
 document.body.classList.toggle("light");
}

let petalOn=true;
function togglePetal(){
 petalOn=!petalOn;
 document.getElementById("petals").style.display=petalOn?"block":"none";
}

const flowers=["ğŸŒ¸","ğŸŒ¼","ğŸŒº"];
const box=document.getElementById("petals");
for(let i=0;i<25;i++){
 let p=document.createElement("div");
 p.className="petal";
 p.innerText=flowers[Math.floor(Math.random()*flowers.length)];
 p.style.left=Math.random()*100+"vw";
 p.style.fontSize=(14+Math.random()*18)+"px";
 p.style.animationDuration=(10+Math.random()*10)+"s,"+(3+Math.random()*4)+"s";
 p.style.animationDelay=Math.random()*5+"s";
 box.appendChild(p);
}

/* ===== PHÃM Táº®T ===== */
document.addEventListener("keydown",e=>{
 if(e.key==="g")getGPS();
 if(e.key==="w")draw();
 if(e.key==="s")download();
});
</script>

</body>
</html>
